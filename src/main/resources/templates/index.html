<!DOCTYPE html>
<html>

<head>
    <meta charset="ISO-8859-1">
    <title>Carrinho de Compras</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .border-purple {
            border-color: purple !important;
        }

        .bg-purple {
            background-color: purple !important;
        }

        .text-purple {
            color: purple !important;
        }

        .body {
            background: linear-gradient(45deg, rgb(251, 128, 36), rgb(255, 213, 170));
        }

        .item {
            background-color: (rgb(251, 128, 36));
        }
    </style>
</head>

<body>
    <div class="position-absolute top-50 start-50 translate-middle min-vw-100 ">
        <div class="container p-5 body  rounded glass-effect">
            <div class="row">
                <div class="col">
                    <h1 class="p-3 mb-3 text-center text-light">O seu <span class="text-purple w-2">EasyShoppTime</span>
                        chegou!!</h1>
                    <hr>
                </div>
            </div>
            <div class="row d-flex  justify-content-between">

                <div class="col-7 p-3 item rounded">
                    <!--Nav Tabs-->
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="add-list-tab" data-bs-toggle="tab"
                                data-bs-target="#add-list" type="button" role="tab" aria-controls="add-list"
                                aria-selected="true">Adicionar Lista</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link text-light" id="add-product-tab" data-bs-toggle="tab"
                                data-bs-target="#add-product" type="button" role="tab" aria-controls="add-product"
                                aria-selected="false">Adicionar Produto</button>
                        </li>
                    </ul>
                    <!--Conteúdo-->
                    <div class="tab-content" id="myTabContent">
                        <!--Cadastrar nova lista-->
                        <div class="tab-pane fade show active" id="add-list" role="tabpanel"
                            aria-labelledby="add-list-tab">
                            <div class="mt-3">
                                <h2 class="text-light">Cadastrar Lista de Compras</h2>
                                <form id="list-form">
                                    <div class="row d-flex justify-content-start">
                                        <div class="col-8 mb-3">
                                            <label for="listName" class="form-label text-light">Nome da Lista: </label>
                                            <input type="text" class="form-control border border-purple" id="listName"
                                                required>
                                        </div>
                                        <div class="mb-3 col-2 d-flex align-items-end">
                                            <button type="submit" class="btn bg-purple text-light">Adicionar</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <!--Cadastrar novo produto-->
                        <div class="tab-pane fade" id="add-product" role="tabpanel" aria-labelledby="add-product-tab">
                            <div class="mt-3">
                                <h2 class="text-light">Adicionar Produto</h2>
                                <form id="product-form">
                                    <div class="row">
                                        <div class="mb-3 col-4">
                                            <label for="productName" class="form-label text-light">Produto: </label>
                                            <input type="text" class="form-control border border-purple"
                                                id="productName" required>
                                        </div>
                                        <div class="mb-3 col-4">
                                            <label for="productTags" class="form-label  text-light">Escolher
                                                Lista</label>
                                            <select class="form-select  border border-purple" id="productTags" required>
                                                <option value="" selected disabled>Escolha uma TAG</option>
                                                <option value="limpeza">Produto de Limpeza</option>
                                                <option value="frios">Frios</option>
                                                <option value="fruta">Frutas</option>
                                            </select>
                                        </div>
                                        <div class="mb-3 col-4">
                                            <label for="productQuantity" class="form-label  text-light">Quantidade:
                                            </label>
                                            <input type="number" class="form-control border border-purple"
                                                id="productQuantity" required>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="mb-3 col-8">
                                            <label for="productList" class="form-label  text-light">Escolher
                                                Lista</label>
                                            <select class="form-select  border border-purple" id="productList" required>
                                                <option value="" disabled>Escolha uma lista</option>
                                            </select>
                                        </div>
                                        <div class="mb-3 col-3 d-flex align-items-end">
                                            <button type="submit" class="btn bg-purple text-light">Adicionar</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <!--Visualização das listas cadastradas-->
                <div class="col-4 bg-p rounded">
                    <h2 class="text-light">Listas Cadastradas</h2>
                    <ul id="lists-list" class="list-group text-light">
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal com detalhes das listas -->
    <div class="modal fade" id="viewListModal" tabindex="-1" aria-labelledby="viewListModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewListModalLabel">Detalhes da Lista</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="listDetails">
                    <!-- Lista de produtos de cada lista -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Arrays para armazenar listas e produtos
        const lists = [];
        const products = {};

        // Referências aos elementos do DOM
        const productForm = document.getElementById('product-form');
        const listForm = document.getElementById('list-form');
        const listsList = document.getElementById('lists-list');
        const productListSelect = document.getElementById('productList');
        const productList = {};
        const userUuid = '6697b517-25ec-4107-b611-d4276aabb6e0';

        // Função para adicionar uma nova lista
        async function addList(event) {
            event.preventDefault();
            const listName = document.getElementById('listName').value;

            if (listName.trim() !== "") {
                // Adiciona a lista ao array de listas
                lists.push(listName);
                products[listName] = [];

                // Atualiza a lista de listas cadastradas
                updateListsDisplay(listName);

                // Atualiza o select de listas no formulário de adicionar produtos
                updateProductListSelect(listName);

                // Limpa o formulário de listas
                listForm.reset();
            }

            await fetch('http://localhost:8080/change/' + (Object.keys(products).length - 1), {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify()
            })
                .then(response => response.json())
                .then(data => console.log('Success:', data))
                .catch(error => console.error('Error:', error));
        }

        // Função para atualizar a exibição das listas cadastradas
        function updateListsDisplay(listName) {
            const newList = document.createElement('li');
            newList.className = 'list-group-item d-flex justify-content-between align-items-center';
            newList.textContent = listName;

            const viewButton = document.createElement('button');
            viewButton.className = 'btn bg-purple btn-sm ms-3 text-light';
            viewButton.textContent = 'Visualizar';
            viewButton.onclick = () => viewList(listName);

            newList.appendChild(viewButton);
            listsList.appendChild(newList);
        }

        // Função para atualizar o select de listas no formulário de adicionar produtos
        function updateProductListSelect(listName) {
            const newOption = document.createElement('option');
            newOption.value = listName;
            newOption.textContent = listName;
            productListSelect.appendChild(newOption);
            productList[listName] = Object.keys(productList).length - 1;
            if (productList[listName] === -1) {
                productList[listName] = 0;
            }
        }

        // Função para adicionar um novo produto
        async function addProduct(event) {
            event.preventDefault();
            const productName = document.getElementById('productName').value;
            const productTag = document.getElementById('productTags').value;
            const productQuantity = document.getElementById('productQuantity').value;
            const selectedList = document.getElementById('productList').value;

            if (productName.trim() !== "" && productQuantity.trim() !== "" && selectedList.trim() !== "") {
                // Adiciona o produto na lista selecionada
                products[selectedList].push({ name: productName, tag: productTag, quantity: productQuantity });

                // Limpa o formulário de produtos
                productForm.reset();
            }



            await fetch('http://localhost:8080/change/' + productList[selectedList], {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify()
            })
                .then(response => response.json())
                .then(data => console.log('Success:', data))
                .catch(error => console.error('Error:', error));


            await fetch('http://localhost:8080/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    userUuid: userUuid,
                    title: productName,
                    tag: productTag,
                    qtd: productQuantity
                })
            })
                .then(response => response.json())
                .then(data => console.log('Success:', data))
                .catch(error => console.error('Error:', error));
        }

        // Função para visualizar os produtos de uma lista
        function viewList(listName) {
            const modal = new bootstrap.Modal(document.getElementById('viewListModal'));
            const listDetails = document.getElementById('listDetails');
            listDetails.innerHTML = '';

            products[listName].forEach((product, index) => {
                const productDiv = document.createElement('div');
                productDiv.className = 'd-flex justify-content-between align-items-center mb-2';

                const productInfo = document.createElement('span');
                productInfo.textContent = `${product.name} - Qty: ${product.quantity} - #${product.tag}`;
                productDiv.appendChild(productInfo);

                const editButton = document.createElement('button');
                editButton.className = 'btn btn-warning btn-sm ms-3';
                editButton.textContent = 'Editar';
                editButton.onclick = () => editProduct(listName, index);
                productDiv.appendChild(editButton);

                listDetails.appendChild(productDiv);
            });

            modal.show();
        }

        // Função para editar um produto
        async function editProduct(listName, index) {
            const product = products[listName][index];
            const newName = prompt('Novo nome do produto:', product.name);
            const newQuantity = prompt('Nova quantidade do produto:', product.quantity);

            if (newName && newQuantity) {
                products[listName][index].name = newName;
                products[listName][index].quantity = newQuantity;
                viewList(listName);
            }


            await fetch('http://localhost:8080/', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    userUuid: userUuid,
                    title: newName,
                    qtd: newQuantity
                })
            })
                .then(response => response.json())
                .then(data => console.log('Success:', data))
                .catch(error => console.error('Error:', error));
        }

        // Adiciona os event listeners para os formulários
        listForm.addEventListener('submit', addList);
        productForm.addEventListener('submit', addProduct);
    </script>
</body>

</html>